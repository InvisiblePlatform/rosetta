<link rel="stylesheet" href="/css/plugin-styles.css">
<title>Invisible Voice - {{ .Params.title }}</title>

<div class="plugin-container">
  <div class="plugin-header">
      <span class="bk-bg co-name">{{ .Params.title }}</span>
    <p class="disclaimer-text" style="width:50%;">
      We are confident the information we are showing is accurate, however we strongly advise you do your own research into any companies.
    </p>
    <section id="button-list">
    {{ with .Params.tosdr }}
    <section id="tosdr-link" style="margin:.5em 0 0 .5em;display:block;">
<a href="https://tosdr.org/en/service/{{.}}">
    <img src="https://shields.tosdr.org/en_{{.}}.svg"/></a>
</section>
    {{ end }}
    {{ with .Params.mbfc }}
    <section id="mbfc-header" style="margin: .5em 0 0 .5em;font-size:.7em;display:block;">
    {{ $data := getJSON "data/mbfc/combined.json" }}
    {{ $dataJ := index $data.sources . }}
    {{ $.Scratch.Set "bias" ""}}
    Media Bias Fact Check <a class="source" href="{{ $dataJ.u }}" >(source)</a>
    {{ if eq $dataJ.b "C" }}
        {{ $.Scratch.Set "bias" (index $data.biases "center")}}
    {{ else if (eq $dataJ.b "L") }}
        {{ $.Scratch.Set "bias" (index $data.biases "left")}}
    {{ else if (eq $dataJ.b "LC") }}
        {{ $.Scratch.Set "bias" (index $data.biases "left-center")}}
    {{ else if (eq $dataJ.b "R") }}
        {{ $.Scratch.Set "bias" (index $data.biases "right")}}
    {{ else if (eq $dataJ.b "RC") }}
        {{ $.Scratch.Set "bias" (index $data.biases "right-center")}}
    {{ else if (eq $dataJ.b "PS") }}
        {{ $.Scratch.Set "bias" (index $data.biases "pro-science")}}
    {{ else if (eq $dataJ.b "FN") }}
        {{ $.Scratch.Set "bias" (index $data.biases "fake-news")}}
    {{ else if (eq $dataJ.b "CP") }}
        {{ $.Scratch.Set "bias" (index $data.biases "conspiricy")}}
    {{ else if (eq $dataJ.b "S") }}
        {{ $.Scratch.Set "bias" (index $data.biases "satire")}}
    {{ end }}
    {{ $bias := $.Scratch.Get "bias"}}
    </br>
    Bias: <a href="{{ $bias.url }}">{{ $bias.name }}</a></br>
    </section>
</br>
    {{ end }}
    {{ with getJSON (print "data/trust-pilot/sites/trust_site_" .Params.title ".json") }}
        {{ if ne .name "ApplicationError" }}
        <section id="trust-pilot">
            {{ $score := .score.trustScore}}
            {{ if eq (int .numberOfReviews.total) 0 }}
                {{ with .name.identifying }}
                <a href="https://trustpilot.com/review/{{.}}" >Trust Pilot</a>: unrated </br>
                {{ else }}
                <a href="https://trustpilot.com/review/{{.name}}" >Trust Pilot</a>: unrated </br>
                {{ end }}
            {{ else }}
            {{ with .name.identifying }}
            <a href="https://trustpilot.com/review/{{.}}" >Trust Pilot</a>: {{ $score }} </br>
            {{ else }}
            <a href="https://trustpilot.com/review/{{.name}}" >Trust Pilot</a>: {{ $score }} </br>
            {{ end }}
            {{ end }}
        </section>
        {{ end }}
    {{ end }}
    </section>
    </div>
  </div>
  <div class="content"> 
    {{ partial "similar.html" .Params.title }}
  </div>
  <div class="content">
    {{ .Content }}
  </div>
  {{ if eq .WordCount 0 }}
    No content yet!
  {{ end }}
  

</div>


<script>

  let hoverAnchors = document.querySelectorAll('.hover-anchor');
  let wW = window.innerWidth;

  hoverAnchors.forEach(el => {
    let elPos = el.getBoundingClientRect();
    let sixty = wW * 60 / 100;
    let hoverPop = el.querySelector('.hover-pop');

    if (elPos.left > sixty) {
      hoverPop.classList.remove('dot');
      hoverPop.classList.add('dot-right');
    }
  })

  let loadWikiInfo = function(x) {
  	let url = x.firstElementChild.getAttribute("href");	
  	if (url != "null"){
  		let term = url.replace("https://en.wikipedia.org/wiki/", ""); 
  		let requestURL = "https://en.wikipedia.org/api/rest_v1/page/summary/" + term + "?redirect=true"
  		$.ajax({
  		    url: requestURL
  		  }).done(function(data) {
  			if (data.thumbnail){
  				x.lastElementChild.innerHTML = "<img class='thumbnail' width='100%' src='" + data.thumbnail.source + "'> " + data.extract_html;	
  			} else {
  				x.lastElementChild.innerHTML = data.extract_html;	
  			}
  		  }).fail(function() {
  			  console.log("oh no")
  		});
  	} else {
  		x.lastElementChild.innerHTML = x.firstElementChild.innerHTML;
  	}
  	x.removeAttribute("onmouseover");
    }
  
  var coll = document.getElementsByClassName("collapsible");
  var i;
  for (i = 0; i < coll.length; i++) {
    coll[i].addEventListener("click", function() {
      this.classList.toggle("active");
      var content = this.nextElementSibling;
      if (content.style.display === "block") {
        content.style.display = "none";
      } else {
        content.style.display = "block";
      }
    }); 
    } 

</script>

    <script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
      crossorigin="anonymous"></script>
